import{n as a,_ as n,E as o,C as l}from"./app-620eae05.js";const c={components:{Modal:()=>n(()=>import("./Modal-27ce5e7d.js"),["assets/Modal-27ce5e7d.js","assets/app-620eae05.js","assets/app-7eda0943.css"])},mixins:[o,l],data:function(){return{statistics:{},pendingPrescriberCount:0,pendingPharmacyOrdersCount:0,pendingPharmacyOrders:[],onHoldOrders:[],pendingOrderAlerts:[],loadingPendingPharmacy:!1,loaded:!1,orderFilter:this.$route.query.orderFilter||localStorage.getItem("dashboard.orderFilter")?localStorage.getItem("dashboard.orderFilter"):userInfo.role==20||userInfo.role==19?"approved":"new",checkboxStatus:!1,duplicateReference:0,userInfo,appInfo,mapping:{safety:"safety check",new:"new",approved:"approved",dpd:"dpd",ups:"ups",dhl:"dhl",rml:"rml",awaiting:"awaiting shipped",shipped:"shipped",onhold:"onhold",queried:"queried",rejected:"rejected",cancelled:"cancelled",return:"returned"},roleVisibility:{60:[],50:[],40:[],35:[],30:[],29:[],25:[],20:[],19:[],10:[],5:[]},countTimer:null}},computed:{checked(){return this.$store.state.checked},visible(){return this.$store.state.visible},match(){return this.checked.length==0?!1:this.visible.every(s=>this.checked.indexOf(s)>=0)},currentChecked(){return this.checked.length==0?!1:this.checked.some(s=>this.visible.indexOf(s)>=0)},trayLength(){return this.$store.state.tray.length}},mounted(){this.getStatistics(),this.getCount(),this.getOrderAlerts(),this.getOnHoldOrders(),this.$root.$on("changefilter",s=>{this.orderFilter=s.filter}),this.$root.$on("orderupdate",this.getOrderAlerts)},destroyed(){this.$root.$off("changefilter"),this.$root.$off("orderupdate"),clearInterval(this.countTimer)},methods:{getStatistics(){axios.get("/statistics").then(s=>{this.statistics=s.data.data,this.statistics.total=s.data.data.total,this.loaded=!0}).catch(s=>{this.postError(s.response.data.message)})},getCount(s=!1){this.loadingPendingPharmacy=!0,s?(this.getOrderAlerts(),this.checkOrders(()=>{this.getCount(),this.getOnHoldOrders(),this.$root.$emit("alertupdate")})):axios.get("/api/check-orders/results").then(e=>{this.pendingPrescriberCount=e.data.data.pendingPrescriberCount,this.pendingPharmacyOrders=e.data.data.pendingPharmacyOrders,this.pendingPharmacyOrdersCount=e.data.data.pendingPharmacyOrdersCount}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.loadingPendingPharmacy=!1,this.$root.$emit("alertupdate")})},getOrderAlerts(){axios.get("/note/pending-alerts").then(s=>{this.pendingOrderAlerts=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},getOnHoldOrders(){axios.get("/orders/on-hold-postponed").then(s=>{this.onHoldOrders=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},deleteNote(s){this.$swal({title:"Delete Alert",html:"Are you sure you want to delete this alert?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(e=>{e.value&&axios.post("/note/"+s+"/delete").then(t=>{this.postSuccess(t.data.message)}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.getOrderAlerts(),this.$root.$emit("alertupdate")})})},editNote(s=!1){this.$root.$emit("modal.open","note",s)},getPendingCSV(){let s=[];this.pendingPharmacyOrders.forEach(e=>{s.push({ReferenceNumber:e.Value})}),this.exportCSV(s,`Pending Pharmacy Orders ${new Date().toLocaleString()}`)},checkOrders(s=!1){axios.get("/api/check-orders").then(e=>{s&&s()}).catch(e=>{this.postError(e.response.data.data),this.loadingPendingPharmacy=!1})},redirectCallback(){this.orderFilter=="new"&&this.trayLength<1&&(this.userInfo.role==30||this.userInfo.role==35||this.userInfo.role==29)&&axios.post("/tray/new/insert/20").then(s=>{this.postSuccess(s.data.message),this.$root.$emit("tray.refresh")}).catch(s=>{this.postError(s.response.data.message)})},changeOrder(s){s=="queried"?localStorage.setItem("dashboard.orderFilter",s):localStorage.setItem("dashboard.orderFilter",this.userInfo.role==20||this.userInfo.role==19?"approved":"new"),this.orderFilter=s,this.getStatistics(),this.getCount()},addToTray(){axios.post("/tray",{PrescriptionID:this.checked}).then(s=>{this.postSuccess(s.data.message),this.$store.commit("replaceChecked",[]),this.$root.$emit("tray.refresh"),this.$root.$emit("table.refresh")}).catch(s=>{this.postError(s.response.data.message)})},safe(s){axios.post(`/order-edit/${s}/status`,{status:1}).then(e=>{this.$root.$emit("table.refresh")}).catch(e=>{this.$root.$emit("table.refresh"),this.postError(e.response.data.message)}).finally(()=>{this.getStatistics()})},checkAll(s=!1){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&limit=${s}`).then(e=>{this.$store.commit("replaceChecked",e.data.data)}).catch(e=>{this.postError(e.response.data.message)})},checkByProperty(s,e){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&type=${s}&property=${e}`).then(t=>{this.$store.commit("replaceChecked",t.data.data)}).catch(t=>{this.postError(t.response.data.message)})},checkAllVisible(){this.currentChecked&&!this.match?this.$root.$emit("table.uncheck.all"):this.currentChecked&&this.match?this.$root.$emit("table.uncheck.all"):this.$root.$emit("table.check.all")},clearChecked(){this.checkboxStatus=!1,this.$store.commit("replaceChecked",[])},viewOrder(s){this.$router.push({name:"prescription",params:{id:s}})}}};var d=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"content"},[t("section",[t("div",{staticClass:"prescriptionStats flex-center"},[t("div",{staticClass:"title flex-align-center"},[e._v("Order Statistics")]),t("div",{staticClass:"list"},[e.loaded?t("ul",[e._l(e.statistics.statistics,function(r,i){return e.roleVisibility[e.userInfo.role].includes(i)?e._e():t("li",{staticClass:"list-item-background",class:{active:i==e.orderFilter},on:{click:function(p){return e.changeOrder(i)}}},[t("span",[e._v(e._s(e.mapping[i]))]),e._v(e._s(r)+" ")])}),e.roleVisibility[e.userInfo.role].includes("ordercount")?e._e():t("li",{staticClass:"list-item-background",class:[e.orderFilter=="ordercount"?"active":"",e.pendingPharmacyOrdersCount>0?"blink_me":""],on:{click:function(r){e.orderFilter="ordercount"}}},[t("span",[e._v("Alert")]),e._v(e._s(e.pendingPharmacyOrdersCount)+" ")])],2):t("ul",{staticStyle:{overflow:"hidden"}},[e._m(0)])]),e.loaded?t("div",{staticClass:"total flex-align-center clickable"},[t("span",[e._v("Total")]),e._v(" "+e._s(e.statistics.total)+" "),t("a",{staticClass:"btn smallTextBtn secondaryBtn",attrs:{href:'/orders/csv?page=1&limit=1000&f={"dashboard": true}&strict=true',title:"Download dashboard orders"}},[e._v("Download")])]):e._e()])]),t("section",[t("div",{staticClass:"orderSearch"},[e.orderFilter!="ordercount"?t("data-table",{attrs:{"data-url":"/orders","column-class":"col-lg-12","table-title":"InTray","redirect-name":"prescription","redirect-id":"PrescriptionID",filters:e.orderFilter,"redirect-callback":e.redirectCallback,"checkbox-visible":e.orderFilter=="new"&&[29,30,35].includes(e.userInfo.role),"hidden-columns":["checked","disabled","UPSAccessPointAddress"],"not-orderable":["Products"],"column-map":{PrescriptionID:"ID",DeliveryID:"Courier",CompanyName:"Client",ReferenceNumber:"Ref"}},scopedSlots:e._u([e.orderFilter=="new"&&[29,30,35].includes(e.userInfo.role)?{key:"filters",fn:function(){return[t("div",{staticClass:"row check-row"},[t("div",{staticClass:"button-group"},[t("div",{staticClass:"btn btnSize02 secondaryBtn",on:{click:function(r){return e.checkAllVisible()}}},[t("input",{class:{unchecked:!e.match&&e.currentChecked},attrs:{type:"checkbox",name:"checkall"},domProps:{checked:e.match||e.currentChecked}}),t("label",{attrs:{for:"checkall"}})]),t("div",{staticClass:"btn btnSize02 secondaryBtn dropdown"},[t("i",{staticClass:"fa fa-caret-down",attrs:{"aria-hidden":"true"}}),t("ul",{staticClass:"dropdown-menu"},[t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkAll()}}},[e._v(" Check All In "+e._s(e.orderFilter)+" ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkAll(10)}}},[e._v(" Check 10 ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkAll(20)}}},[e._v(" Check 20 ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkAll(50)}}},[e._v(" Check 50 ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkAll(100)}}},[e._v(" Check 100 ")]),t("li",[t("hr")]),e.appInfo.delivery_companies.includes("dpd")?t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("delivery",4)}}},[e._v(" Check DPD ")]):e._e(),e.appInfo.delivery_companies.includes("dhl")?t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("delivery",10)}}},[e._v(" Check DHL ")]):e._e(),e.appInfo.delivery_companies.includes("ups")?t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("delivery",7)}}},[e._v(" Check UPS ")]):e._e(),e.appInfo.delivery_companies.includes("rml")?t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("delivery",5)}}},[e._v(" Check RM ")]):e._e(),t("li",[t("hr")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("client",50)}}},[e._v(" Check Treated ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("client",51)}}},[e._v(" Check EveAdam ")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.checkByProperty("client",49)}}},[e._v(" Check Apport Sarl ")]),t("li",[t("hr")]),t("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return e.clearChecked()}}},[e._v(" Clear checked ")])])])]),e.checked.length>0?t("div",{staticClass:"check-options"},[t("button",{staticClass:"btn btnSize02 secondaryBtn",on:{click:function(r){return e.addToTray()}}},[e.userInfo.role==20||e.userInfo.role==19?t("span",[e._v("Take over")]):t("span",[e._v("Add To Tray")]),e._v(" ("+e._s(e.checked.length)+" orders) ")])]):e._e()])]},proxy:!0}:null,e.orderFilter=="safety"&&e.userInfo.role==40?{key:"tools",fn:function(r){return[t("a",{staticClass:"btn btn-primary waves-effect table-icon clickable",on:{click:function(i){return e.safe(r.id)}}},[e._v(" Safe ")])]}}:null],null,!0)}):e.orderFilter=="ordercount"?t("div",{staticClass:"card prescription-pool"},[t("div",{staticClass:"card-body order-id-list"},[t("ul",[t("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("b",[e._v("MISSING PHARMACY ORDERS "),t("span",{staticClass:"badge",class:[e.pendingPharmacyOrders.length>0?"red":""]},[e._v(e._s(e.pendingPharmacyOrders.length))])]),t("div",[t("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Download CSV with a list of reference numbers"},on:{click:function(r){return e.getPendingCSV()}}},[t("i",{staticClass:"fa fa-file",attrs:{"aria-hidden":"true"}})]),t("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Refresh the pending pharmacy orders list manually"},on:{click:function(r){return e.getCount(!0)}}},[t("i",{staticClass:"fa fa-refresh",class:[e.loadingPendingPharmacy?"spin-animation":""]})])])]),e.pendingPharmacyOrders.length>0?t("li",{staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[t("b",[e._v("Reference Number")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Client")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Status")])])]):e._e(),e._l(e.pendingPharmacyOrders,function(r){return t("li",{key:r.SyncOrderID,staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[e._v(e._s(r.Value))]),t("div",{staticClass:"pool-column"},[t("span",[e._v(e._s(r.CompanyName))])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Pending")])])])})],2),e.pendingPharmacyOrdersCount+e.pendingPrescriberCount==0?t("ul",[t("li",{staticClass:"pool-list-title"},[t("b",[e._v("NO PENDING PHARMACY ORDERS FOUND")])])]):e._e(),t("ul",{staticClass:"mt-10"},[t("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("b",[e._v("POSTPONED SHIPPING ORDERS PENDING "),t("span",{staticClass:"badge",class:[e.onHoldOrders.length>0?"red":""]},[e._v(e._s(e.onHoldOrders.length))])])]),e.onHoldOrders.length>0?t("li",{staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[t("b",[e._v("ID")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Reference Number")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Postponed At")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Postponed By")])]),t("div",{staticClass:"pool-column"},[e._v("Tools")])]):e._e(),e._l(e.onHoldOrders,function(r){return t("li",{key:r.PrescriptionID,staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[t("b",[e._v(e._s(r.PrescriptionID))])]),t("div",{staticClass:"pool-column"},[t("div",{domProps:{innerHTML:e._s(r.ReferenceNumber)}})]),t("div",{staticClass:"pool-column"},[e._v(e._s(r.PostponedAt))]),t("div",{staticClass:"pool-column"},[e._v(e._s(r.PostponedBy))]),t("div",{staticClass:"pool-column"},[t("a",{staticClass:"btn btn-primary table-icon",attrs:{title:"View Order",target:"_blank",href:`#/prescription/${r.PrescriptionID}`}},[t("i",{staticClass:"fa fa-search-plus",attrs:{"aria-hidden":"true"}})])])])})],2),t("ul",{staticClass:"mt-10"},[t("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("b",[e._v("PENDING ORDER ALERTS "),t("span",{staticClass:"badge",class:[e.pendingOrderAlerts.length>0?"red":""]},[e._v(e._s(e.pendingOrderAlerts.length))])]),t("div",[t("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Create an alert for a prescription that is not yet imported on ESA"},on:{click:function(r){return e.$root.$emit("modal.open","note","preimport")}}},[e._v(" Create Alert ")])])]),e.pendingOrderAlerts.length>0?t("li",{staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[t("b",[e._v("Reference Number")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Note")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Created By")])]),t("div",{staticClass:"pool-column"},[t("b",[e._v("Created At")])]),e.userInfo.role>=40?t("div",{staticClass:"pool-column"},[e._v(" Tools ")]):e._e()]):e._e(),e._l(e.pendingOrderAlerts,function(r){return t("li",{key:r.NoteID,staticClass:"pool-list-layout"},[t("div",{staticClass:"pool-column"},[r.Subscription?t("div",[t("small",[e._v("Subscription ID: "),t("b",[e._v(e._s(r.Subscription))])]),t("br"),t("small",[e._v("Reference number not set")])]):t("b",[e._v(e._s(r.ReferenceNumber))])]),t("div",{staticClass:"pool-column"},[t("div",{domProps:{innerHTML:e._s(r.Note)}})]),t("div",{staticClass:"pool-column"},[e._v(" "+e._s(r.name)+" "+e._s(r.surname)+" ")]),t("div",{staticClass:"pool-column"},[e._v(e._s(r.CreatedAt))]),e.userInfo.role>=40?t("div",{staticClass:"pool-column"},[t("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Edit alert"},on:{click:function(i){return e.editNote(r)}}},[t("i",{staticClass:"fa fa-edit",attrs:{"aria-hidden":"true"}})]),t("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Delete this alert"},on:{click:function(i){return e.deleteNote(r.NoteID)}}},[t("i",{staticClass:"fa fa-trash",attrs:{"aria-hidden":"true"}})])]):e._e()])})],2)])]):e._e()],1)])])])},u=[function(){var s=this,e=s._self._c;return e("li",[e("div",{staticClass:"loader loader-relative"},[s._v("Loading...")])])}],h=a(c,d,u,!1,null,null,null,null);const v=h.exports;export{v as default};
