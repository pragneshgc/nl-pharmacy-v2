import{n as r,E as c,C as l,_ as d}from"./app-620eae05.js";const u={mixins:[c,l],components:{Modal:()=>d(()=>import("./Modal-27ce5e7d.js"),["assets/Modal-27ce5e7d.js","assets/app-620eae05.js","assets/app-7eda0943.css"])},data(){return{loading:!1,statuses:{0:"INCOMPLETE",1:"UNPAID",2:"PAID",3:"CREDITNOTE",4:"DELETED"},item:!1,invoice:{},invoiceItems:[],userInfo,appInfo}},mounted(){this.getInvoice()},methods:{addItem(){this.item={UnitCost:"",VAT:0,Description:"",ReferenceNumber:"",PrescriptionID:0,Type:3},this.$root.$emit("modal.open","additem")},deleteItem(s){this.$swal({title:`Delete Item #${s}`,html:"Are you sure you want to delete this item?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes! Delete it!"}).then(t=>{t.value&&(this.loading=!0,axios.delete(`/invoice/${this.$route.params.id}/item/${s}`).then(e=>{this.getInvoice(),this.postSuccess(e.data.message)}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.loading=!1}))})},saveItem(){this.loading=!0,axios.post(`/invoice/${this.$route.params.id}/item`,this.item).then(s=>{this.item=!1,this.getInvoice(),this.postSuccess(s.data.message),this.$root.$emit("modal.close","additem")}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loading=!1})},getInvoice(){this.loading=!0,axios.get(`/invoice/${this.$route.params.id}`).then(s=>{this.invoice=s.data.data.invoice,this.invoiceItems=s.data.data.invoiceItems}).catch(s=>{console.log(s)}).finally(()=>{this.loading=!1})},downloadInvoice(){window.open(`/invoice/${this.$route.params.id}/view?token=${this.userInfo.token}`,"_blank")},updateInvoiceStatus(s,t=!1){this.loading=!0,axios.post(`/invoice/${this.$route.params.id}/status`,{status:s,date:t}).then(e=>{this.getInvoice(),this.postSuccess(e.data.message)}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.loading=!1})},emailInvoice(){this.loading=!0,axios.post(`/invoice/${this.$route.params.id}/email?token=${this.userInfo.token}`).then(s=>{this.postSuccess(s.data.message)}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loading=!1})},setAllAsComplete(){this.$swal({title:`Set all ${this.invoice.Client} invoices as complete`,html:`This will set all ${this.invoice.Client} invoices as complete and email them to the email set in the client field. Are you sure?`,type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(s=>{s.value&&(this.loading=!0,axios.post(`/invoice/${this.invoice.ClientID}/set-all-complete?token=${this.userInfo.token}`).then(t=>{this.getInvoice(),this.postSuccess(t.data.message)}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.loading=!1}))})},setAllAsPaid(){this.$swal({title:`Set all unpaid ${this.invoice.Client} invoices as paid`,html:`This will set all unpaid ${this.invoice.Client} invoices as paid. Are you sure?`,type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(s=>{s.value&&(this.loading=!0,axios.post(`/invoice/${this.invoice.ClientID}/set-all-paid?token=${this.userInfo.token}`).then(t=>{this.getInvoice(),this.postSuccess(t.data.message)}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.loading=!1}))})},downloadInvoiceCSV(){}}};var m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content"},[e("Modal",{staticClass:"duplicate-modal",attrs:{"modal-name":"additem"},scopedSlots:t._u([{key:"header",fn:function(){return[e("h2",[t._v("Add Item")])]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"pxp-form wow fadeIn",staticStyle:{height:"auto !important"}},[e("div",{staticClass:"form-row"},[e("h3",{staticClass:"m-10"},[t._v("Information")])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Description"}},[t._v("Description")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.item.Description,expression:"item.Description"}],staticClass:"form-control",attrs:{name:"Description",autocomplete:"off",type:"text",placeholder:"Description"},domProps:{value:t.item.Description},on:{input:function(i){i.target.composing||t.$set(t.item,"Description",i.target.value)}}})])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"PrescriptionID"}},[t._v("PrescriptionID")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.item.PrescriptionID,expression:"item.PrescriptionID"}],staticClass:"form-control",attrs:{name:"PrescriptionID",autocomplete:"off",type:"text",placeholder:"PrescriptionID"},domProps:{value:t.item.PrescriptionID},on:{input:function(i){i.target.composing||t.$set(t.item,"PrescriptionID",i.target.value)}}})])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"ReferenceNumber"}},[t._v("Customer Reference")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.item.ReferenceNumber,expression:"item.ReferenceNumber"}],staticClass:"form-control",attrs:{name:"ReferenceNumber",autocomplete:"off",type:"text",placeholder:"ReferenceNumber"},domProps:{value:t.item.ReferenceNumber},on:{input:function(i){i.target.composing||t.$set(t.item,"ReferenceNumber",i.target.value)}}})])]),e("div",{staticClass:"form-row"},[e("h3",{staticClass:"m-10"},[t._v("Price")])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"UnitCost"}},[t._v("Price")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.item.UnitCost,expression:"item.UnitCost"}],staticClass:"form-control",attrs:{name:"UnitCost",autocomplete:"off",type:"text",placeholder:"UnitCost"},domProps:{value:t.item.UnitCost},on:{input:function(i){i.target.composing||t.$set(t.item,"UnitCost",i.target.value)}}})])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"VAT"}},[t._v("VAT "),e("span",{staticClass:"danger"},[t._v("(Value in currency "+t._s(t.appInfo.currency)+" amount)")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.item.VAT,expression:"item.VAT"}],staticClass:"form-control",attrs:{name:"VAT",autocomplete:"off",type:"text",placeholder:"VAT"},domProps:{value:t.item.VAT},on:{input:function(i){i.target.composing||t.$set(t.item,"VAT",i.target.value)}}})])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Type"}},[t._v("Type")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.item.Type,expression:"item.Type"}],staticClass:"browser-default custom-select",attrs:{name:"Type"},on:{change:function(i){var a=Array.prototype.filter.call(i.target.options,function(o){return o.selected}).map(function(o){var n="_value"in o?o._value:o.value;return n});t.$set(t.item,"Type",i.target.multiple?a:a[0])}}},[e("option",{domProps:{value:3}},[t._v("Credit/Refund")]),e("option",{domProps:{value:4}},[t._v("Misc Charge")])])])])])]},proxy:!0},{key:"footer",fn:function(){return[e("button",{staticClass:"btn btnSize01 tertiaryBtn",on:{click:function(i){return t.saveItem()}}},[t._v(" Save Item ")])]},proxy:!0}])}),e("section",{staticClass:"card"},[e("div",{staticClass:"card-header"},[e("h3",[t._v("Invoice #"+t._s(t.invoice.InvoiceID)+" Details")])]),e("div",{staticClass:"card-body",staticStyle:{display:"flex","flex-direction":"raw","justify-content":"space-between"}},[e("div",{staticClass:"invoice-details"},[e("span",[t._v(t._s(t.invoice.Client)+" Invoice # "+t._s(t.invoice.InvoiceID))]),e("br"),e("span",[t._v("DATE COVERED: "+t._s(t.invoice["Created Date"])+" - "+t._s(t.invoice["Created Date"]))]),e("br"),e("span",[t._v("DATE COMPLETED: "+t._s(t.invoice["Completed Date"]))]),e("br"),e("span",[t._v("DATE PAID: "+t._s(t.invoice["Paid Date"]))]),e("br"),e("span",[t._v("GROSS AMOUNT : "+t._s(t.appInfo.currency)+t._s(t.invoice.GrossAmount))]),e("br"),e("span",[t._v("VAT : "+t._s(t.appInfo.currency)+t._s((Math.floor(t.invoice.VAT*100)/100).toFixed(2)))]),e("br"),e("span",[t._v("NET AMOUNT : "+t._s(t.appInfo.currency)+t._s(t.invoice.NetAmount))]),e("br"),e("span",[t._v("AMOUNT RECEIVED : "+t._s(t.appInfo.currency)+t._s(t.invoice.AmountReceived))]),e("br"),e("span",[t._v("STATUS : "+t._s(t.statuses[t.invoice.Status]))]),e("br")]),e("div",{staticClass:"invoice-options"},[t.invoice.Status!=0?e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"Email Invoice"},on:{click:function(i){return t.emailInvoice()}}},[t._v(" Email Invoice ")]):t._e(),e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"Add Item"},on:{click:function(i){return t.addItem()}}},[t._v(" Add Item ")]),t.invoice.Status==0?e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"Set Invoice as Complete"},on:{click:function(i){return t.updateInvoiceStatus(1)}}},[t._v(" Set Invoice as Complete ")]):t._e(),t.invoice.Status==1?e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"Set Invoice As Paid"},on:{click:function(i){return t.updateInvoiceStatus(2)}}},[t._v(" Set Invoice As Paid ")]):t._e(),e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"View PDF"},on:{click:function(i){return t.downloadInvoice()}}},[t._v(" View Invoice ")]),e("button",{staticClass:"btn btnSize02 secondaryBtn",attrs:{disabled:t.loading,title:"Download CSV"},on:{click:function(i){return t.exportCSV(t.invoiceItems,"Invoice Items")}}},[t._v(" Download CSV ")]),e("div",{staticClass:"invoice-options mt-10"},[e("h3",{staticClass:"mb-10 danger"},[t._v(" The button below applies to all currently incomplete "),e("b",[t._v(t._s(t.invoice.Client))]),t._v(" invoices ")]),t.invoice.Status==0?e("button",{staticClass:"btn btnSize02 primaryBtn",attrs:{disabled:t.loading,title:"Set all as complete and email Invoice"},on:{click:function(i){return t.setAllAsComplete()}}},[t.loading?e("div",{staticClass:"loader"},[t._v("Loading...")]):t._e(),t._v(" Set All incomplete "+t._s(t.invoice.Client)+" Invoices as complete and email them ")]):t._e(),t.invoice.Status==1?e("button",{staticClass:"btn btnSize02 primaryBtn",attrs:{disabled:t.loading,title:"Set all as paid"},on:{click:function(i){return t.setAllAsPaid()}}},[t._v(" Set All unpaid "+t._s(t.invoice.Client)+" Invoices as paid ")]):t._e()])])]),e("div",{staticClass:"card-body",staticStyle:{padding:"0px"}},[e("table",[t._m(0),e("tbody",[t._l(t.invoiceItems,function(i){return[e("tr",{key:i.ItemID},[e("td",[t._v(t._s(i.ReferenceNumber))]),e("td",[t._v(t._s(i.ItemID))]),e("td",[t._v(t._s(i.Date))]),e("td",[t._v(t._s(i.Description))]),e("td",[t._v(t._s(i.Quantity))]),e("td",[t._v(t._s(t.appInfo.currency)+t._s(i.UnitCost))]),e("td",[t._v(t._s(t.appInfo.currency)+t._s(i.VAT))]),e("td",[t._v(t._s(t.appInfo.currency)+t._s(i.Total))]),e("td",[[3,4].includes(i.Type)&&i.Description!="DISPENSING FEE"?e("a",{staticClass:"btn btn-primary waves-effect table-icon clickable",staticStyle:{margin:"0px"},on:{click:function(a){return t.deleteItem(i.ItemID)}}},[e("i",{staticClass:"fa fa-trash",attrs:{"aria-hidden":"true"}})]):t._e()])])]})],2)])])])],1)},v=[function(){var s=this,t=s._self._c;return t("thead",[t("tr",[t("th",[s._v("Customer Reference")]),t("th",[s._v("ESA Reference #")]),t("th",[s._v("Date")]),t("th",[s._v("Description")]),t("th",[s._v("Quantity")]),t("th",[s._v("Price")]),t("th",[s._v("VAT")]),t("th",[s._v("Total")]),t("th",[s._v("Tools")])])])}],p=r(u,m,v,!1,null,null,null,null);const _=p.exports;export{_ as default};
